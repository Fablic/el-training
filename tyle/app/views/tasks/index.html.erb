<%= render 'header' %>

<!-- search form -->
<div class="card col-md-6">
  <div class="card-body">
    <%= form_with url: tasks_path, local: true, html: { method: :get } do |f| %>
      <div class="form-row">
        <div class="col-auto">
          <%= f.text_field :name, value: params[:name], class: 'form-control-sm', id: 'search_by_name', placeholder: t('activerecord.attributes.task.name') %>
        </div>
        <div class="col-auto">
          <%= select_tag :priority, options_for_select(Task.priorities.map { |k, v| [t("enums.task.priority.#{k}"), v] }, selected: params[:priority]), prompt: t('activerecord.attributes.task.priority'), class: 'form-control-sm', id: 'search_by_priority' %>
        </div>
        <div class="col-auto">
          <%= select_tag :status, options_for_select(Task.statuses.map { |k, v| [t("enums.task.status.#{k}"), v] }, selected: params[:status]), prompt: t('activerecord.attributes.task.status'), class: 'form-control-sm', id: 'search_by_status' %>
        </div>
        <div class="col-auto">
          <%= f.submit t('button.search'), class: 'btn btn-sm btn-primary'%>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- task list -->
<div class="card col-md-6">
  <div class="card-body">
    <div class="card-title">
      <figcaption class="figure-caption text-center"><%= t('operation.task-list') %></figcaption>
    </div>
    <table class="table table-sm">
      <thead>
        <tr>
          <th><%= t('activerecord.attributes.task.name') %></th>
          <th>
            <%= switch_asc_and_desc('priority', @sort_column, @sort_direction) %>
            <%= show_asc_or_desc('priority', @sort_column, @sort_direction) %>
          </th>
          <th>
            <%= switch_asc_and_desc('status', @sort_column, @sort_direction) %>
            <%= show_asc_or_desc('status', @sort_column, @sort_direction) %>
          </th>
          <th>
            <%= switch_asc_and_desc('due', @sort_column, @sort_direction) %>
            <%= show_asc_or_desc('due', @sort_column, @sort_direction) %>
          </th>
          <th>
            <%= switch_asc_and_desc('created_at', @sort_column, @sort_direction) %>
            <%= show_asc_or_desc('created_at', @sort_column, @sort_direction) %>
          </th>
          <th><%= t('button.detail') %></th>
        </tr>
      </thead>
      <tbody>
        <% @tasks.each do |task| %>
          <tr>
            <td class="task-name"><%= task.name %></td>
            <td class="task-priority"><%= t("enums.task.priority.#{task.priority}") %></td>
            <td class="task-status"><%= t("enums.task.status.#{task.status}") %></td>
            <td class="task-due"><%= I18n.l(task.due) %></td>
            <td class="task-created-at"><%= I18n.l(task.created_at) %></td>
            <td><%= link_to t('activerecord.attributes.task.detail'), task_path(task.id) %></td>
          </tr>
        <% end %>
      </tbody>
      </table>
    <%= paginate @tasks %>
  </div>
</div>
