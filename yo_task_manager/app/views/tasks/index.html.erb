<div class="container-fluid">
  <div class="row search-form mt-1">
    <div class="col-9">
      <%= search_form_for @q do |f| %>
        <div class="row">
          <div class="col-6">
            <%= f.label t('tasks.task_name') %>:
            <%= f.search_field :title_cont, class: 'form-control' %>
          </div>
          <div class="col-6">
            <%= f.label t('tasks.task_state') %>:
            <%= f.select :aasm_state_eq, aasm_states_option, {}, { class: 'form-control' } %>
          </div>
        </div>
        <div class="row justify-content-between mt-3">
          <div class="col-12">
            <%= f.submit t('.search'), name: nil, class: 'btn btn-primary' %>
          </div>
        </div>
      <% end %>
    </div>
    <div class="col-3 align-self-end d-flex justify-content-end">
      <%= button_to t('.add_task'), new_task_path, method: :get, class: 'btn btn-primary' %>
    </div>
  </div>
  <div class="row justify-content-end mt-3">
    <div class="col-3 d-flex justify-content-end">
      <% if @tasks.present? %>
        <p><%= t('.task_count') %>: <%= @tasks.count %></p>
      <% else %>
        <p><%= t('.no_task') %></p>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      <% flash.each do |name, msg| %>
        <%= content_tag :div, msg.join('<br>').html_safe, class: "alert-#{name}" %>
      <% end %>
    </div>
  </div>
  <div class="row justify-content-end">
    <div class="col-4">
      <%= paginate @tasks %>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      <% if @tasks.present? %>
        <table class="table table-striped table-bordered">
          <thead class="thead-dark">
            <tr>
              <th><%= sort_link(@q, :id, 'ID') %></th>
              <th><%= sort_link(@q, :user_id, t('tasks.task_user')) %></th>
              <th><%= sort_link(@q, :title, t('tasks.task_name')) %></th>
              <th><%= sort_link(@q, :body, t('tasks.task_detail')) %></th>
              <th><%= sort_link(@q, :task_limit, t('tasks.task_limit')) %></th>
              <th><%= sort_link(@q, :aasm_state, t('tasks.task_state')) %></th>
              <th><%= sort_link(@q, :label, t('tasks.task_label')) %></th>
              <th><%= t('action') %></th>
            </tr>
          </thead>
          <tbody>
            <% @tasks.each do |t| %>
              <tr id="task-<%= t.id %>">
                <td><%= t.id %></td>
                <td><%= t.user.display_name %></td>
                <td class="task-name"><%= t.title %></td>
                <td><%= t.body %></td>
                <td class="task-limit"><%= l(t.task_limit, format: :long, default: '-') %></td>
                <td><%= Task.human_attribute_name("aasm_state.#{t.aasm_state}") %></td>
                <td>
                  <% t.labels&.each do |l| %>
                    <%= label_tag l.name, nil, class: 'badge badge-pill badge-primary' %>
                  <% end %>
                </td>
                <td>
                  <%= button_to t('button.detail'), task_path(t), method: :get, class: 'btn btn-info', form: { style: 'display: inline-block;' } %>
                  <%= button_to t('button.edit'), edit_task_path(t), method: :get, class: 'btn btn-warning', form: { style: 'display: inline-block;' } %>
                  <%= button_to t('button.delete'), task_path(t), method: :delete, class: 'btn btn-danger', form: { style: 'display: inline-block;' } %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% end %>
    </div>
  </div>
  <div class="row justify-content-end">
    <div class="col-4">
      <%= paginate @tasks %>
    </div>
  </div>
</div>
