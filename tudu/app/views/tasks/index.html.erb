<h1><%= t('task.index.title') %></h1>

<div class="search-box">
  <%= form_tag(root_path, method: :get, enforce_utf8: false, class: "form-horizontal") do %>
    <div class="form-group">
      <label class="col-xs-2 control-label" for="q">検索キーワード</label>
      <div class="col-xs-2">
        <%= text_field_tag :q, params[:q], { size: 20, class: "form-control" } %>
      </div>
    </div>
    <div class="form-group">
      <label class="col-xs-2 control-label" for="status">ステータス</label>
      <div class="col-xs-2">
        <%= select_tag :status, options_for_select(Task::STATUS.invert, :selected => params[:status]),  { include_blank: '---', class: "form-control" } %>
      </div>
      <div class="col-xs-2">
        <%= submit_tag '検索', :name => nil, class: "btn btn-primary" %>
      </div>
    </div>
  <% end %>
</div>

<table class="p-task-list table table-hover">
  <thead>
    <tr>
      <th scope="row"><%= t('activerecord.attributes.task.name') %></th>
      <th><%= t('activerecord.attributes.task.content') %></th>
      <th>
        <%= sortable("expire_date", t('activerecord.attributes.task.expire_date'), @search_task) %>
      </th>
      <th><%= t('activerecord.attributes.task.status') %></th>
      <th>
        <%= t('activerecord.attributes.task.created_at') %>
      </th>
      <th><%= t('action.table_heading_operation') %></th>
    </tr>
  </thead>
  <tbody>
  <% @tasks.each do |task| %>
    <%
      # TODO: STEP16 bullet の動作確認用
      task.user.email
    %>
    <tr>
      <td><%= task.name %></td>
      <td><%= task.content %></td>
      <td><%= l(task.expire_date.to_date) if task.expire_date.present? %></td>
      <td><%= Task::STATUS.fetch(task.status) %></td>
      <td><%= l(task.created_at.to_datetime) %></td>
      <td>
        <ul class="list-inline">
          <li><%= link_to t('action.show'), task_path(task), { class: "btn btn-default" } %></li>
          <li><%= link_to t('action.edit'), edit_task_path(task), { class: "btn btn-primary" } %></li>
          <li><%= link_to t('action.delete'), task, class: "btn btn-danger", method: :delete,
            data: { confirm: t('task.delete.confirm') } %></li>
        </ul>
      </td>
    <% end %>
  </tbody>
</table>
<div>
  <%= paginate @tasks %>
</div>
